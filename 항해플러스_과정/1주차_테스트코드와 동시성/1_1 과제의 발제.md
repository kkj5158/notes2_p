## 목차
[[1_1 과제의 발제]]
[[1_2 과제의 요건]]
[[1_3 과제의 분석]]
[[1_4 과제의 구현 _ 기본기능의 구현]]
[[1_5 과제의 구현 _ 테스트 코드의 작성]]
[[1_6 과제의 구현 _  동시성 코드의 작성 ( 해결 )]]
[[1_7 과제의 이론 _ 테스트코드를 위한 이론]]
[[1_8 과제의 이론 _ 동시성 처리를 위한 이론]]
[[1_9 과제의 이론 _ 클린코드를 위한 이론 ]]
[[1_10 과제의 이론 + a _ 로깅을 위한 이론]]
[[1_11 과제의 회고 (WIL + KPT)]]
[[1_12 과제의 발전 _ 추가 고려사항]]
# Chapter 1-1 TDD & 클린 아키텍처

<aside> 🎯 들어가면서, Why TDD?

</aside>

- TDD, 왜 그렇게 많이 언급 되는건지? 왜 중요할까?

    개발해야되는 스코프가 점점 더 많아지고 거대한 규모의 소프트웨어가 많아짐에 따라, 유지보수 및 장애 발생시 대처를 유연하게 할 수 있는 방법론으로 다들 회귀하기 시작했습니다. 즉, 코드의 규모는 점점 커지고 유저가 많아짐에 따라 예측하기 힘든 행동 패턴들에 의한 장애가 발생하기 시작한 거죠. 소위 새로운 기능을 만들기 위해 “요구사항을 찍어낸다” 식의 단순 재래식 개발로는 소프트웨어의 품질을 지속적으로 유지하고 향상시킬 수 없었기에 테스트 자동화에 대한 중요성은 점점 대두되어 왔습니다. 요구사항이 변경되었을 때, 기존의 기능이 영향이 없는가? 등을 검증하기 위한 방법론들이 주목받지 못하고 있다가 빠른 변화에도 유연하게 새로운 기능을 적용하고 변경할 수 있는 기반을 다질 수 있는 TDD 에 대한 중요성이 더욱 더 중요해지고 있습니다.

- 현업에서의 TDD란?

    사람마다 생각하는 스코프가 조금 천차만별인 경우가 많은 것 같습니다. 이는 현재 본인의 일하는 환경에 따른 영향, 조직의 업무량과 방식 등이 매우 상이하기 때문인데 특히 테스트에 대한 중요성과 작성 여력이겠죠. 그래서 저는 어떤 조직에 합류하던 최대한 작성하려는 기능을 분석 후 핵심이 되는 테스트 코드부터 작성하고 이를 완성하기 위해 적용된 아키텍처에 맞는 기능 개발을 진행합니다. 그리고 모든 테스트를 완료하는 순간, 목표한 개발 스코프가 종료되었다는 기준으로 테스트 주도 개발을 진행합니다. 작업 여건 상 짧게 개발하고, 테스트 해보고 실패하면 리팩토링하는 방식을 취하는 대신에 대신 분석/설계 단계에서 테스트 코드를 면밀히 작성해두고 모든 TC 성공 시엔 개발 컨텍스트를 완료하는 방식을 취하고 있습니다.

- 여기서 우리가 TDD에 대해 알게되는 것들

    백엔드 개발자로서, 요구사항을 분석하고 기능을 올바르게 완성하기 위한 TC 를 작성하는 방법을 익힙니다. 특정 문제 상황에 대해 올바른 기능을 제공하기 위해서 어떤 테스트케이스를 단계적으로 작성해나갈 수 있는지, 점진적으로 우리가 작성한 기능을 리팩토링 하며 올바른 백엔드 서비스를 제공할 수 있는 방법을 익힙니다. 또한 테스트 코드를 잘 작성할 수 있는 소프트웨어의 구조 등을 고민해보고 이를 적용해 요구사항에 맞는 백엔드 서비스를 개발해봅니다.


<aside> ⛵ 이번 챕터 목표

</aside>

- 테스트 가능한 코드와 테스트 코드 작성에 집중하며, TDD 기반 요구사항 기능 개발
- TDD, Testable Code, Test Code 에 대한 학습을 진행합니다.
- 기초 학습자료로 부족한 부분을 학습합니다.
- 주어진 과제를 분석하고 TDD 기반으로 개발을 진행합니다.

<aside> ⚠️ 기초 학습 자료

</aside>

[[1_TDD 레슨]]

[[1_Jest 기초]]

[[1_JUnit With Kotlin]]

[[1_NextJS 단위 테스트 - 예제가 포함된 방법 가이드]]

_(참고자료) 학습 관련 링크_

- [JPA 에 대한 이해 ( 영상 자료 )](https://www.youtube.com/watch?v=WnYPdkNSLy8&themeRefresh=1)
- [JUnit 3일 안에 배우기](https://www.guru99.com/ko/junit-tutorial.html)
- [nestjs + jest 로 unit test 따라하기](https://www.tomray.dev/nestjs-unit-testing)

<aside> 🚩 학습자료 : 이번 챕터에 해야 할 것. 이것만 집중하세요!

</aside>




ℹ️ Test Pyramid
![[항해플러스_1주차발제_테스트코드.png]]
`Unit Testing`

- 대상 : 단일 기능 혹은 작은 단위의 함수/객체 등
- 가벼운 비용으로 새로운 기능 혹은 개선이 기존의 rule 을 위배하지 않는지 점검

`Integration Testing`

- 대상 : 서로 다른 module / system 의 상호작용
- 맞물려 돌아가는 기능이 모여 정상적으로 원하는 기능을 제공하는지 점검

`End-to-End Testing`

- 대상 : 전체 애플리케이션의 흐름
- 애플리케이션이 제공하는 기능을 사용자 시나리오 기반으로 문제 없는지 점검

ℹ️ Test Double

테스트 더블은 실제 컴포넌트를 대체할 수 있도록 하는 대역이다.

실제 컴포넌트에 대해 행동을 모방하고, 이를 통해 기존의 강한 결합도를 낮추고 테스트 중 제어 가능하도록 한다.

`Mock`

- 테스트를 위해 특정 기능에 대해 정해진 응답을 제공하는 객체
- 입력과 상관없이 어떤 행동 을 할 지에 초점을 맞춘 객체
- Mock Library 를 통해 특정 행동에 대한 출력을 정의

`Stub`

- 테스트에 필요한 호출에 대해 미리 준비된 응답을 제공하는 객체
- 입력에 대해 어떤 상태 를 반영하는 지에 초점을 맞춘 객체
- Interface 기반으로 테스트에서 보고자하는 (혹은 필요로 하는) 구현에 집중한 구현체를 정의

ℹ️ Testable Code

- 모든 코드를 테스트 가능하게 구현하는 것을 목표로 진행합니다.
- 모든 테스트 케이스가 성공했다는 것은 목표한 기능이 완성되었다는 것을 의미합니다.
- 테스트 커버리지 100% 가 아니라, 정확히 기능의 동작을 확인하는 테스트를 작성해 주세요.
- 주요 기능에서 `private` 접근자, 객체간의 강결합 같이 테스트 불가능한 코드는 가능한 한 지양하는 것이 좋습니다.

```kotlin
#1) 기능 구현을 원하는 요구사항을 검증하는 테스트 추가
#2) 테스트를 만족하도록 기능 구현
>> 이 때, 테스트는 한번에 많은 Scope 를 잡지 않는다. 이는 불필요한 개발 생산성 저하로 이어진다.
>> 이 시점에서 우리가 몇 배의 시간을 더 투자한다고 해서 테스트 커버리지 100% 를 달성할 수는 없다.
#3) 구현된 기능에 대한 리팩토링 ( 인터페이스 구성, 코드클리닝 등 코드 베이스 정리 )
```

- 참고 : [TestPyramid](https://martinfowler.com/bliki/TestPyramid.html)

<aside> ⚠️ 주의 ! 단순히 테스트 커버리지 100% 를 목표하기보다 기능에 대해 유의미한 테스트케이스를 고민하고 작성해보세요.

</aside>

<aside> 🚩 과제 : 이번 챕터 과제

</aside>

[[1_2 과제의 요건]]

<aside> 🗓️ Weekly Schedule Summary: 이번 챕터의 주간 일정 (각 요일 자정까지 제출)

</aside>

### `이것부터 시작하세요!`

- PR 템플릿 세팅하기!
    
    - Repo를 생성하고 `.github` 폴더를 생성 후 `pull_request_template.md` 파일을 만들어서 아래 템플릿을 복사/붙여넣기해주세요!
        
    - PR 템플릿
        
        ```markdown
        ### 커밋 링크
        <!-- 
        좋은 피드백을 받기 위해 가장 중요한 것은 코드를 작성할 때 커밋을 작업 단위로 잘 쪼개는 것입니다.
        모든 작업을 하나의 커밋에 진행하고 PR을 하면 구조 파악에 많은 시간을 소모하기 때문에 절대로
        좋은 피드백을 받을 수 없습니다.
        
        필수 양식)
        커밋 이름 : 커밋 링크
        
        예시)
        동시성 처리 : c83845
        동시성 테스트 코드 : d93ji3
        -->
        
        ---
        ### 리뷰 포인트(질문)
        - 리뷰 포인트 1
        - 리뷰 포인트 2
        <!-- - 리뷰어가 특히 확인해야 할 부분이나 신경 써야 할 코드가 있다면 명확히 작성해주세요.(최대 2개)
          
          좋은 예:
          - `ErrorMessage` 컴포넌트의 상태 업데이트 로직이 적절한지 검토 부탁드립니다.
          - 추가한 유닛 테스트(`LoginError.test.js`)의 테스트 케이스가 충분한지 확인 부탁드립니다.
        
          나쁜 예:
          - 개선사항을 알려주세요.
          - 코드 전반적으로 봐주세요.
          - 뭘 질문할지 모르겠어요. -->
        ---
        ### 이번주 KPT 회고
        
        ### Keep
        <!-- 유지해야 할 좋은 점 -->
        
        ### Problem
        <!--개선이 필요한 점-->
        
        ### Try
        <!-- 새롭게 시도할 점 -->
        ```
        
- `/point` 패키지 (디렉토리) 내에 `PointService` 기본 기능 작성
    
- `/database` 패키지의 구현체는 수정하지 않고, 이를 활용해 기능을 구현
    
- 각 기능에 대한 단위 테스트 작성
    

> 총 4가지 기본 기능 (포인트 조회, 포인트 충전/사용 내역 조회, 충전, 사용) 을 구현합니다.

### STEP01`기본과제`

- 포인트 충전, 사용에 대한 정책 추가 (잔고 부족, 최대 잔고 등)
- 동시에 여러 요청이 들어오더라도 순서대로 (혹은 한번에 하나의 요청씩만) 제어될 수 있도록 리팩토링
- 동시성 제어에 대한 통합 테스트 작성

### STEP02`심화과제`

- 동시성 제어 방식에 대한 분석 및 보고서 작성 ( [README.md](http://README.md) )

위 요구사항을 만족시키고, Github Repository URL 을 제출해주세요

과제준비를 완성하여야, 기본과제와 심화과제를 통과하실 수 있습니다.

### FAQ

- TDD 가 아닌 DDD 로 개발하는 것은 안될까요 ?


    A : DDD 와 TDD 는 같은 범주로 묶이는 개발론이 아닙니다. DDD 는 기존 DB 테이블 중심적으로 설계하고, 서비스를 구성하는 방식보다 요구사항에 대해 도메인을 명확히 분석하고, 도메인이 주체가 되도록 기능을 개발하는 방식을 의미합니다. 즉, 설계론적인 의미에서 더 많은 이점을 찾고자 하는 개발론이죠. TDD 는 개발하는 방식을 테스트적인 관점에서 바라보는 방법론입니다. 이에 DDD 로 개발할 때는 각 도메인의 컨텍스트를 보다 명확하게 정의하고, 기능을 단순화하고 정확하게 표현할 수 있어야 합니다.


    A : 위에 설명한 바처럼 오히려 DDD 기반의 설계와 구현에 대해 익숙하고 잘 정의되어 있다면 TDD 방법론을 이용해 개발을 진행하기에 오히려 적합한 구조를 갖출 수 있다고 생각해요. TDD 는 각 기능에 대해 작은 단위로 구성하고 Unit Test 부터 잘 작성해나가며 빠른 주기로 개발/테스트/리팩토링을 반복해나가며 기능을 완성해나가는 방식인데, 도메인이 잘 정의되어 있고 기능에 대한 책임이 명확히 나뉘어져 있다면 더 빠른 개발을 진행할 수 있습니다.