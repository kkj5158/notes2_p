# 1.수업 신청 시스템 과제 설명서

## 프로젝트 개요

학생(Student)과 튜터(Tutor) 간 1:1 수업 예약 시스템을 개발하는 과제입니다. 학생은 수업 가능한 시간대를 조회하고, 해당 시간의 튜터를 확인한 후 수업을 신청할 수 있습니다. 튜터는 자신이 가능한 시간대를 기준으로 수업을 오픈합니다.

## 개발 환경 및 기술 스택

- Java 11
- Spring Boot 2.7.18
- MyBatis 2.2.2
- Swagger (springdoc-openapi-ui 1.6.15)
- MySQL
- JUnit 5 (SpringBootTest 기반)
- Gradle
## 주요 기능
### 튜터 관련
- 튜터가 수업 생성: /lessons/create
- 튜터가 수업 삭제: /lessons/delete
### 학생 관련
- 수업 가능한 시간 조회: /lessons/available-times
- 수업 가능한 튜터 조회: /lessons/available-tutors
- 수업 신청: /lessons/apply
- 신청한 수업 조회: /lessons/applied
    
## 제약 사항 및 정책
- 모든 수업은 **정각 또는 30분**에 시작해야 합니다.
- 수업 시간은 **30분 또는 60분**만 허용됩니다.
- 튜터는 중복된 시간에 수업을 생성할 수 없습니다.
- 학생은 동일한 시간대에 여러 수업을 신청할 수 없습니다.
- 신청이 완료되면 해당 수업의 상태는 `RESERVED`로 변경됩니다. ( 모든 수업은 1대 1을 기준으로 가집니다.)
    

## 테스트 환경 구성

- 테스트는 실제 Docker 기반 MySQL을 통해 실행합니다
- `@Transactional`로 테스트 간 롤백 보장
- API 테스트는 MockMvc + ObjectMapper 기반으로 수행

# 2. ERD 구조 

![[Pasted image 20250419145954.png]]

## 테이블 구성 

이 시스템은 총 4개의 테이블로 구성되어 있습니다:

### `student`

- 학생 정보를 저장하는 테이블입니다.
- `student_id`는 기본 키로 사용되며, 학생의 고유 식별자입니다.
- 이름(`name`)과 이메일(`email`)은 필수 값입니다.
    

### `tutor`

- 튜터 정보를 저장하는 테이블입니다. 
- `tutor_id`는 기본 키로 사용되며, 튜터의 고유 식별자입니다.
- 이름(`name`)과 이메일(`email`)은 필수 값입니다.
    

### `lesson`

- 튜터가 개설한 수업 정보를 저장하는 테이블입니다.
- `lesson_id`는 기본 키이며, 각 수업의 고유 ID입니다.
- `tutor_id`는 수업을 개설한 튜터를 참조합니다.
- `start_time`, `end_time`은 수업의 시간 정보를 나타냅니다.
- `status`는 수업의 상태(`AVAILABLE`, `RESERVED`)를 나타냅니다. 기본값은 `AVAILABLE`입니다.
- 하나의 튜터는 동일한 시간대에 중복 수업을 개설할 수 없도록 `(tutor_id, start_time, end_time)` 조합에 유니크 인덱스를 설정했습니다.
    

### `lesson_participant`

- 학생이 신청한 수업을 저장하는 테이블입니다.
- 하나의 수업에는 한 명의 학생만 신청할 수 있으며, 각 `(lesson_id, student_id)` 조합은 유일해야 합니다.
- `lesson_id`, `student_id`는 각각 수업과 학생 테이블을 참조하는 외래 키 역할을 합니다.

## 외래키 고민 

 본 시스템은 논리적 설계 단계에서 외래 키 관계를 정의하였으나, 실제 데이터베이스 생성 시에는 성능 및 유연성을 고려하여 외래 키 제약 조건을 물리적으로 설정하지 않았습니다. 대신, 애플리케이션 레벨에서 참조 무결성을 검증하도록 구현되어 있습니다.

# 3. API 명세 


_API 명세는 Swagger UI를 통해 확인하실 수 있습니다._

애플리케이션 실행 후, 아래 경로에서 모든 엔드포인트 및 Request/Response 예시를 시각적으로 확인할 수 있습니다:

```
http://localhost:8080/swagger-ui/index.html
```

Swagger를 통해 각 API의 입력값, 응답 구조, 예외 메시지까지 테스트해볼 수 있습니다.


# 4. 구조와 기술적 고려사항 
## 디렉터리 구조

linge.lingleregsys
├── controller       # REST API 엔드포인트
├── service          # 비즈니스 로직
├── repository       # MyBatis Repository 인터페이스
├── mapper           # XML Mapper 인터페이스
├── dto              # 요청/응답 DTO
├── model            # 도메인 객체
├── common           # 예외, 공통 응답 포맷 등


## 기술적 의사결정 및 고려사항

- 테스트 환경에서도 운영 환경과 유사한 조건을 유지하기 위해 H2가 아닌 Docker 기반 MySQL 사용
- 외래 키 제약 조건은 DB에 직접 설정하지 않고, 애플리케이션 레벨에서 무결성 검증으로 대체
- 테스트에서는 `@Transactional`을 활용하여 테스트 간 데이터 롤백 처리로 격리 보장
- Jasypt를 도입하여 설정 파일 내의 DB 비밀번호 등 민감 정보를 암호화하여 저장하고, 애플리케이션 실행 시 복호화하도록 처리
- 환경 별 설정 분리를 위해 `dev`, `stg`, `prod`, `test` 등의 profile을 활용하고, 각 환경에 맞는 DB 연결 정보와 Jasypt 키를 분리하여 관리함

# 테스트 케이스 

테스트 코드는 `src/test/java/linge/lingleregsys/e2e/RegSysE2ETest.java` 에 위치해 있으며, `@SpringBootTest` 기반으로 작성되어 전체 애플리케이션 컨텍스트를 통해 실제 서비스 로직과 DB 연동을 검증합니다.

### 실행 방법

```
./gradlew test
```

또는 IntelliJ 기준 해당 테스트 클래스에서 직접 실행할 수 있습니다.

| 번호 | 테스트 케이스                          | 설명 |
|------|-----------------------------------------|------|
| 1    | 튜터 수업 생성                         | 정상적으로 lessonId 반환되고 DB에 저장됨 |
| 2    | 없는 튜터 수업 생성                    | 존재하지 않는 tutorId로 수업 생성 시 에러 발생 |
| 3    | 중복 수업 생성 방지                    | 같은 시간대에 중복 수업 생성 시 에러 발생 |
| 4    | 학생 수업 신청                         | 정상적으로 신청되고 DB에 저장됨 |
| 5    | 수강 신청 조회                         | 신청한 수업 목록이 정확히 조회됨 |
| 6    | 없는 수업 신청                         | 존재하지 않는 lessonId로 신청 시 에러 발생 |
| 7    | 없는 학생 신청                         | 존재하지 않는 studentId로 신청 시 에러 발생 |
| 8    | 중복 신청 방지                         | 같은 수업에 두 번 신청할 수 없음 |
| 9    | 가능한 시간 조회                       | 시간 범위에 맞는 수업 시간만 조회됨 |
| 10   | 가능한 튜터 조회                       | 조건에 맞는 수업을 가진 튜터가 조회됨 |
| 11   | 비어있는 시간 조회                     | 수업이 없는 시간대는 빈 리스트 반환 |
| 12   | 잘못된 시간 순서                       | 종료 시간이 시작 시간보다 빠르면 에러 발생 |
| 13   | 시간 단위 위반                         | 30분 단위가 아닌 수업은 생성 불가 |
| 14   | 수업 시간 충돌                         | 기존 수업과 시간이 겹치면 신청 불가 |
| 15   | 예약된 수업 신청                       | 이미 신청된 수업은 다른 학생이 신청할 수 없음 |
| 16   | 신청 내역 없음                         | 수업 신청 내역이 없을 경우 빈 배열 반환 |
| 17   | 수업 삭제                              | lesson 및 participant 모두 삭제됨 |
| 18   | 없는 수업 삭제                         | 존재하지 않는 수업 삭제 시 에러 발생 |
| 19   | 삭제 후 조회                           | 삭제된 수업은 조회 결과에서 제외됨 |


